using System;
using System.Windows.Forms;

namespace AuditScaner
{
    public partial class Scan : Form
    {
        private Form currentChildForm;
        public static string selectedFileName;
        private readonly string fileLocation = "C:\\VulnerabilityScanner";

        public Scan()
        {
            InitializeComponent();
            //Form settings
            Text = "Scan for Vulnerabilities";
            ControlBox = false;
            DoubleBuffered = true;
            MaximizedBounds = Screen.FromHandle(Handle).WorkingArea;
            //Load files
            populateDropDown();
            //Make sure no error from no file
            scanBtn.Enabled = false;
        }

        private void FileList_SelectedIndexChanged(object sender, EventArgs e)
        {
            selectedFileName = FileList.Text;
            scanBtn.Enabled = true;
        }

        private void populateDropDown()
        {
            FileList.Items.AddRange(System.IO.Directory.GetFiles(fileLocation));
        }

        //Deprecated, maybe will remove later
        private void reloadFileList()
        {
            FileList.Text = string.Empty;
            FileList.Items.Clear();
            populateDropDown();
        }

        private void scanBtn_Click(object sender, EventArgs e)
        {
            selectedFileName = FileList.Text;
            OpenChildForm(new ScannedReport());
        }

        private void OpenChildForm(Form childForm)
        {

            currentChildForm = childForm;
            childForm.TopLevel = false;
            childForm.FormBorderStyle = FormBorderStyle.None;
            childForm.Dock = DockStyle.Fill;
            Controls.Add(childForm);
            childForm.Tag = childForm;
            childForm.BringToFront();
            childForm.Show();

        }

    }
}
